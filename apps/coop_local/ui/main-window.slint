// SPDX-FileCopyrightText: 2023 Florian Blasius <co_sl@tutanota.com>
// SPDX-License-Identifier: GPL-3.0-only

import { BookmarksView, BookmarksAdapter } from "views/bookmarks-view.slint";
export { BookmarksAdapter }

import { DialogView, DialogAdapter } from "views/dialog-view.slint";
export { DialogAdapter }

import { FilesView, FilesAdapter } from "views/files-view.slint";
export { FilesAdapter }

import { GamesView, GamesAdapter, GameSettingsAdapter } from "views/games-view.slint";
export { GamesAdapter, GameSettingsAdapter }

import { ImageView, ImageAdapter } from "views/image-view.slint";
export { ImageAdapter }

import { TextView, TextAdapter } from "views/text-view.slint";
export { TextAdapter }

import { ListViewItem, CoopWindow, Icons, GroupListViewItem, SideBar, LoadingIndicator } from "_imports/coop_widgets.slint";
export { ListViewItem, Icons, GroupListViewItem }

export enum View {
    Files,
    Image,
    Text,
    Games
}

export global MainAdapter {
    in property <View> active-view: View.Files;
    in property <bool> loading;
}

export component MainWindow inherits CoopWindow {
    title: "coop local";
    min-width: 316px;
    min-height: 400px;
    preferred-width: 600px;
    forward-focus: i-focus-scope;

    i-focus-scope := FocusScope {
        key-pressed(event) => {
            if (event.text == Key.Tab) {
                i-bookmarks-view.focus();
                self.enabled = false;
                return accept;
            }

            reject
        }
    }

    GridLayout {
        Rectangle {
            col: 1;

            if (MainAdapter.active-view == View.Files) : FilesView {
                window-height: root.height;
                width: 100%;
                height: 100%;
            }

            if (MainAdapter.active-view == View.Image) : ImageView {
                width: 100%;
                height: 100%;
            }

            if (MainAdapter.active-view == View.Text) : TextView {
                width: 100%;
                height: 100%;
            }

            if (MainAdapter.active-view == View.Games) : GamesView {
                width: 100%;
                height: 100%;
            }
        }

        i-sidebar := SideBar {
            col: 0;
            parent-width: root.width;
            responsive: true;

            i-bookmarks-view := BookmarksView {
                window-height: root.height;

                item-clicked => {
                    if (i-sidebar.expanded) {
                        i-sidebar.expanded = false;
                    }
                }
            }
        }
    }

    DialogView {
        width: 100%;
        height: 100%;
    }

    if (MainAdapter.loading) : LoadingIndicator {
        width: 100%;
        height: 100%;
    }
}